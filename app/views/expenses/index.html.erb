<div id="expenses-index">
    <div id="greeting-msg" class="block">
        Hello, <%= current_user.nickname %>
    </div>

    <div id="budget-setting" class="block">
        <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name)) do |f| %>
            <%= label_tag 'budget-input', 'Your budget:' %>
            <%= f.text_field :budget, value: current_user.budget, id: 'budget-input' %>
            <%= f.submit 'Save', id: 'save-budget-btn' %>
        <% end %>
    </div>

    <% if current_user.expenses_this_month.present? %>
    <% row_id = 1 %>
    <table id="expenses-table" class="block">
        <tr>
            <th>#</th>
            <th>Spent Date</th>
            <th>Name</th>
            <th>Price</th>
            <th></th>
        </tr>
        <% current_user.expenses_this_month.each do |expense| %>
        <tr>
            <td>
                <%= row_id %>
            </td>
            <td>
                <%= expense.spent_date %>
            </td>
            <td>
                <%= expense.name %>
            </td>
            <td>
                ¥<%= expense.price %>
            </td>
            <td>
                <%= image_tag('ic_edit.png', width: '15', class: 'edit-expense', target: expense.id, row: row_id) %>
                <%= link_to image_tag('ic_delete.png', width: '15'), "/expenses/#{expense.id}", method: :delete, data: { confirm: "Are you sure?" } %>
                <%= hidden_field_tag 'expensecategory_id', expense.expensecategory_id %>
            </td>
        </tr>
        <% row_id = row_id + 1 %>
        <% end %>
    </table>

    <div id="expenses-summary" class="block">
        <p>Total amount spent this month: ¥<%= current_user.total_expenses_this_month %></p>
        <p>Average daily budget for remaining days: ¥<%= current_user.average_daily_budget_for_remaining_days %></p>
    </div>
    <% end %>

    <div id="toggle-add-expense-field" class="block">
        <button id="new-expense-btn">New Expense</button>
    </div>

    <%= form_with(url: expenses_path, local: true, id: "add-expense-form", class: "block") do |f| %>
        <div class="field">
            <%= f.label :name %><br />
            <%= f.text_field :name %>
        </div>
        <div class="field">
            <%= f.label :spent_date %><br />
            <%= f.date_field :spent_date %>
        </div>
        <div class="field">
            <%= f.label :price %><br />
            <%= f.number_field :price %>
        </div>
        <div class="field">
            <%= f.label "Category" %><br />
            <%= f.collection_select(:expensecategory_id, Expensecategory.all, :id, :name) %>
        </div>
        <div class="actions">
            <%= button_tag "Back", type: "button", id: "back-to-expense-index-btn"%>
            <%= f.submit "Add expense" %>
        </div>
    <% end %>
    <%= form_with(url: expenses_path, local: true, id: "edit-expense-form", method: "patch", class: "block") do |f| %>
        <div class="field">
            <%= f.label :name %><br />
            <%= f.text_field :name %>
        </div>
        <div class="field">
            <%= f.label :spent_date %><br />
            <%= f.date_field :spent_date %>
        </div>
        <div class="field">
            <%= f.label :price %><br />
            <%= f.number_field :price %>
        </div>
        <div class="field">
            <%= f.label "Category" %><br />
            <%= f.collection_select(:expensecategory_id, Expensecategory.all, :id, :name) %>
        </div>
        <div class="actions">
            <%= button_tag "Back", type: "button", id: "back-to-expense-index-btn"%>
            <%= f.submit "Edit expense" %>
        </div>
    <% end %>
</div>
